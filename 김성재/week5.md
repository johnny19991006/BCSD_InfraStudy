## docker swarm
![](https://velog.velcdn.com/images/seongjae6751/post/fbb3e172-7be3-4713-a2c3-b63e989b6c6e/image.png)
### docker swarm이란?
docker swarm이란 여러 대의 docker 호스트들을 마치 하나인 것처럼 만들어주는 Orchestration 도구이다.

### docker compose랑 docker swarm 뭐가 다른거지?
docker compose는 container를 정의하는 것이고 docker swarm은 서비스를 정의하는 것이므로 둘은 서로 다르다
![](https://velog.velcdn.com/images/seongjae6751/post/3b5248d3-5dce-43d2-ab8b-ba9f8ead1625/image.png)
정리하면 docker compose는 단일 노드에서 애플리케이션을 실행하고 docker swarm은 둘 이상의 서버로 확장이 가능하다. docker compose는 단일 노드에서 실행되기 때문에 애플리케이션을 계속 확장해 나가도 단일 노드'에서 실행되지만, docker swarm을 사용하면 고가용성 및 내결함성이란 장점을 가지고 애플리케이션을 빠르게 확장할 수 있다.

### 뗏목 합의 알고리즘
도커 스웜에서 매니저 노드는 클러스터의 모든 정보를 포함하고 있다. 때문에 매니저 노드'가 죽게 되면 클러스터도 다운되게 된다.
이러한 문제를 해결하기 위해 도커 스웜은 뗏목 합의 알고리즘을 이용한 멀티 매니저 노드 기능을 지원한다.
멀티 매니저 노드 기능을 사용하면 여러 개의 매니저 노드를 생성하여 한 매니저 노드(리더 매니저 노드)가 갑자기 죽게 되더라도 다른 매니저 노드가 다시 서비스를 안정적인 상태로 복원할 수 있다.
하지만 이를 위해서는 모든 매니저 노드가 동일한 상태를 유지하고 있어야 하는데, 이때 사용되는 알고리즘이 뗏목 합의 알고리즘이다.
![](https://velog.velcdn.com/images/seongjae6751/post/6d8f287d-bf51-4991-8683-c68feec59ffb/image.png)

## docker orchestration
![](https://velog.velcdn.com/images/seongjae6751/post/eadf648b-46f4-4444-833a-a15ed31ee7da/image.png)
### 도커 컨테이너로 서비스를 한다는 것은?
도커 컨테이너로 서비스를 하게 되면 하나의 도커 이미지 안에 서비스 운영에 필요한 모든 것들이 있어 개발자들이 손쉽게 협업을 할 수가 있다. 또한 서비스 운영 환경과 개발 환경의 느슨한 결합으로 한쪽의 에러에도 다른 한쪽은 작업을 계속해서 이어 나갈 수가 있다. 도커컨테이너는 배포가 쉽고 빠르며 시스템 의존성을 쉽게 업그레이드 할 수 있어 스케일 아웃에 용이하다. cpu limit, memory limit등의 시스템 자원을 효율적으로 활용할 수 있고 무엇보다 가상머신보다 성능 면에서 뛰어나다.

하지만 이렇게 컨테이너화된 애플리케이션도 역시 관리를 해야 한다. 컨테이너화된 어플리케이션이 다운이 되면 직접 재실행 시켜야 한다.
![](https://velog.velcdn.com/images/seongjae6751/post/b6265119-8f1f-4677-9bb4-aa3f78a0ce0a/image.png)

전통적인 방식과 VM보다 관리가 용이하지만 컨테이너의 스케일 아웃 장점 때문에 관리해야 하는 컨테이너 수가 많아지게 되면 그 또한 해결해야 하는 과제로 남는다.
![](https://velog.velcdn.com/images/seongjae6751/post/943e8841-c28e-4f63-a862-f64512175d2e/image.png)

### 컨테이너 오케이스트레이션이란?
오케스트레이션이란?
수많은 연주자들이 지휘에 맞춰 연주하는 것을 '오케스트라'라고 한다.

컨테이너 오케스트레이션은 말 그대로 컨테이너들을 지휘하는 메인 컨트롤러가 있고 그 지휘에 맞춰 컨테이너의 배포, 관리, 확장, 네트워킹을 자동화하는 것을 말한다.
컨테이너를 사용하는 어떤 횐경에서든 사용할 수 있다.
![](https://velog.velcdn.com/images/seongjae6751/post/ee1a9a4a-24ac-478c-8892-448a3203c4e4/image.png)

### 컨테이너의 계층구조
아래 이미지에서 컨테이너의 계층 구조를 잠깐 살펴보자. 컨테이너 상위계층에 오케스트레이션이 자리 잡고 있다. 5단계 도커 엔진으로 구현되고 있는 컨테이너를 재설계할 필요 없이 각기 다른 환경 전반에 동일한 애플리케이션을 배포하는 데 도움이 된다.
![](https://velog.velcdn.com/images/seongjae6751/post/369d7fac-5828-4a32-b7ad-0d6a56f92176/image.png)

### 컨테이너 오케스트레이션의 기능
* 컨테이너 클러스터링:
    * 여러 대의 노드를 하나의 클러스터로 묶어, 애플리케이션을 분산하여 실행하고, 자원을 효율적으로 활용하는 기능이다.
    * 여러 대의 물리적인 또는 가상의 서버를 하나의 시스템 처럼 동작하게 하는 기술이다.
    * 컨테이너를 실행하는 호스트의 자원을 효율적으로 분배, 컨테이너가 안정적으로 실행 되도록 한다.
    * 여러 대의 컨테이너를 묶어 하나의 서버처럼 사용 할 수 있도록 지원한다.
* 서비스 디스커버리:
    * 컨테이너를 자동으로 발견하고, 서비스 이름과 IP 주소 등을 관리하여, 애플리케이션 간의 연결을 관리하는 기능이다.
    * 클라우드 환경에서의 컨테이너 생성, 배치, 이동에 따른 IP, port 정보 업데이트 및 관리한다.
* 자동 스케일링:
  애플리케이션의 트래픽 양에 따라 자동으로 컨테이너 수를 조절하여, 자원 사용량을 최적화하고, 가용성을 보장한다.
* 로드 밸런싱:
    * 여러 대의 노드에서 실행 중인 컨테이너들을 조절하여, 트래픽을 균등하게 분배하여, 애플리케이션의 성능을 최적화한다.
* 롤아웃과 롤백:
    * 새로운 버전의 애플리케이션을 롤아웃하고, 이전 버전으로 롤백하는 기능이다.
* 자동 복구:
    * 컨테이너나 노드의 장애 시 자동으로 복구하는 기능이다.
* 모니터링과 로깅:
    * 컨테이너나 노드의 상태를 모니터링하고, 로그를 수집하여, 애플리케이션의 성능과 문제점을 분석하는 기능이다.

### 대표적인 컨테이너 오케스트레이션
![](https://velog.velcdn.com/images/seongjae6751/post/8850c583-5c43-483e-b65d-87cdbb842781/image.png)
1. 도커 스웜
* Docker Inc.이 개발한 도커 컨테이너 오케스트레이션 도구이다. 쿠버네티스가 등장하기 전까지 가장 대중적인 컨테이너 오케스트레이션 도구 중 하나였다.
* 간단하게 작동하고 설정이 쉽다.
2. Kubernetes
* gmail, youtube등의 대용량 트래픽을 감당해야 했던 구글이 설계 해서 현재 리눅스 재단에 의해 관리 되고 있는 오픈소스 기반 툴이다.
* 대규모에 적합하다.
    - 스케일링 기능 강화(Replication Controller: 컨테이너 수를 동적으로 조절)
    - 서비스 디스커버리 기능 강화(DNS 기반)
* 가장 기능이 풍부하고 널리 사용되는 컨테이너 오케스트레이션 프레임워크이다.
* VM환경, 퍼블릭 클라우드, 베어 메탈 등의 다양한 환경에서 작동하도록 설계되어 있다
  ![](https://velog.velcdn.com/images/seongjae6751/post/ea31d89b-0f0f-46f6-a1a9-7f8e2aa24058/image.png)
3. EKS(Amazon)
* AWS에서 제공하는 관리형 kubernetes 서비스로 사용자는 kubernetes api로 EKS 클러스터를 관리할 수 있다.
4. ECS(Amazon)
* AWS에서 제공하는 관리형 컨테이너 오케스트레이션 서비스로 docker 컨테이너를 실행하기 위한 기능을 제공한다. 사용자는 ECS를 사용하여 컨테이너를 배포, 관리, 스케일링 할 수 있다.
  ![](https://velog.velcdn.com/images/seongjae6751/post/1725af82-4429-4509-8ed3-5620467d888a/image.png)


## 용어 정리
* node
  도커 서버 단위이다. 보통 한 서버에 하나의 도커 데몬을 실행하기 때문에 노드는 곧 서버라고 이해할 수 있다.(1 node = 1 server)
* manager node
  매니저 노드는 아래의 업무를 통해 도커 클러스터를 관리한다.
    * 뗏목 알고리즘을 사용해서 클러스터의 상태를 유지한다.
    * 스케줄링 서비스: 작업자 노드(worker)에게 컨테이너를 배포한다. 특정 노드에게만 배포하거나, 모든 노드에 하나씩 배포할 수도 있다.
    * 스웜 모드 제공: docker swarm init
* worker node
  매니저 노드로부터 할당받은 작업을 수행하며, 컨테이너를 실행하는 역할을 한다. 서비스 상태를 매니저 노드에게 보고한다.
* ingree network
  swarm 서비스의 외부 퍼블릭 트래픽을 관리하는 네트워크
    * ingress 네트워크는 docker swarm 내부의 서비스를 외부와 연결하는 역할을 하며 로드 밸런싱 기능도 제공한다.
    * ingress 네트워크는 스웜 클러스터를 생성하면 자동으로 생성되는 네트워크로서, 스웜모드를 사용할 때만 유효하다.




## 출처
* https://velog.io/@younghwan/docker-swarm
* https://junnyhi.tistory.com/248
* https://velog.io/@sh93/Docker-Swarm-Network-%EC%A2%85%EB%A5%98
* https://velog.io/@jungmyeong96/Docker-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%98%A4%EC%BC%80%EC%8A%A4%ED%8A%B8%EB%A0%88%EC%9D%B4%EC%85%98
