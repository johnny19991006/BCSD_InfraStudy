# 3주차 : 도커 학습

"도커란 컨테이너 기술을 기반으로 한 일종의 가상화 플랫폼이다.  
가상화란 물리적 자원인 하드웨어를 효율적으로 활용하기 위해 하드웨어 공간 위에 가상의 머신을 만드는 기술이고,  
컨테이너랑 컨테이너가 실행되고 있는 호스트 OS 기능을 그대로 사용하면서 프로세스를 격리해 독립된 환경을 만드는 기술이다.  
즉, 독립된 환경을 만들어서 하드웨어를 효율적으로 활용하는 기술이 도커이다."

​이렇게만 보면 감이 잘 오지 않는다.

### 1. 가상머신 (VM) 
이전 주차에서 우리는 이미 가상머신으로 서비스를 배포해보았다. (EC2)  
물리적 서버위에 독립적인 OS를 가상화하여 여러 독립적인 서버를 실행하는 것이 가상머신이다  
![image](https://github.com/user-attachments/assets/489e9c74-b07b-49ab-a491-24df415a5cf1)  
이런식으로 하나의 물리적 머신에서 가상화를 통해 여러개의 OS로 여러 서버를 실행할 수 있다.  
  
  
  
### 2. 컨테이너  
개발자의 PC와 실 서버마다 모든 것들을 각각 설치해야하는 것이 번거로움이 있다. (ex. 왜 내컴퓨터에서는 되는데 서버에선 안되지?)
컨테이너는 위를 해결해주고, 애플리케이션을 격리된 환경에서 실행할 수 있도록 해주는 기술이다.  
각 컨테이너는 애플리케이션과 그에 필요한 모든 의존성을 포함하고 있으며, 호스트 OS와 커널을 공유하면서 독립적으로 실행된다.

- 경량화: 컨테이너는 VM보다 훨씬 가볍고 빠르게 시작할 수 있다. VM은 전체 OS를 가상화하지만, 컨테이너는 호스트 OS의 커널을 공유한다.
- 빠른 시작: 컨테이너는 VM보다 더 빠르게 시작하고 중지할 수 있다.
- 이식성: 동일한 컨테이너 이미지를 사용하여 개발 환경, 테스트 환경, 생산 환경에서 일관되게 동작할 수 있다.



### VM(가상머신)과 컨테이너의 차이
![image](https://github.com/user-attachments/assets/0f5d031c-9615-4e33-a5a7-2b7e4537112d)

**VM**  
하드웨어 위에 올라가는 vmware나 virtualBox 같은 하이퍼바이저를 이해 독립적인 가상의 머신을 만들 수 있다. 각각 의 VM에는 OS가 올라가기 때문에 굉장히 무겁고 느리다.  
- 하이퍼바이저 : 호스트 컴퓨터에서 다수의 OS를 동시에 실행하기 위한 논리적 플랫폼.​

**컨테이너**  
하드웨어에 설치된 운영체제에 Container Engine(여기선 도커)이라는 소프트웨어를 통해 개별적인 컨테이너로 만들어 각각의 어플리케이션을 고립된 환경에서 가볍고 빠르게 구동할 수 있다. (VM의 경량화 버전​)



## 도커
도커는 위의 문제를 해결하기 위해 필요한 어플리케이션을 패키징 해주는 도구 중 하나이다. 
컨테이너라고 불리는 하나의 작은 소프트웨어 유닛 안에 어플리케이션, 시스템 툴, 환경설정, 디펜던시를 한번에 묶어서 어떤 곳에도 쉽게 배포하고 안정적으로 구동할 수 있게 도와주는 도구이다.
가상화라고 불리는 이유는 옛날에는 하나의 OS에 하나의 어플리케이션만 구동이 가능했지만, 가상화 기술을 통해 하나의 서버에서 여러 개의 환경을 동시에 운영할 수 있다.

​

### 동작 과정
![image](https://github.com/user-attachments/assets/0051d908-f294-448a-9b1e-eaa5dc5219bb)

1. Local에서 Docker를 설치하여 Dockerfile을 생성한다.
2. Dockerfile을 build 시켜 Image로 만든다. 
- Dockerfile : 컨테이너를 어떻게 만들어야하는지(환경변수, 디펜던시 등)에 대한 설명서)  
- Image : 어플리케이션을 실행하는데 필요한 코드, 런타임, 환경, 시스템 툴, 라이브러리 등이 포함. (변경 불가능)
- Container : Image를 고립된 환경에서 개별적인 시스템 안에서 실행할 수 있는 공간
3. 만든 Image를 Container Registry에 push한다.
4. 실서버에 Docker를 설치한 후 Container Registry에서 Image를 pull한다.
5. 실서버의 Docker에서 Image를 run한다.



### 현재 사용하는 ECS 동작과정

1. ECS 클러스터 설정
- 컨테이너 인스턴스(EC2 인스턴스 또는 Fargate 작업)를 그룹화하여 관리하는 클러스터를 생성한다.

2. Docker Image 준비
 - Docker Image 빌드 : Dockerfile을 사용하여 애플리케이션 환경을 정의한다. jar파일을 Docker Image로 변환한다.
 - Docker Image push : 이미지를 Docker Hub나 Amazon ECR(Elastic Container Registry) 같은 이미지 레지스트리에 푸시한다.

3. Task Definition 작성:
 - Task 정의를 작성한다: ECS에서 컨테이너를 실행하기 위해 JSON 형식으로 task 정의와 컨테이너 설정을 정의한다.

4. 서비스 생성:
 - ECS에서 Task Definition을 기반으로 컨테이너를 실행할 서비스를 설정한다.
 - 로드 밸런서를 설정하여 트래픽을 컨테이너에 분산시킬 수 있고, 오토 스케일링을 지원한다.

5. 작업 실행:
- Task 정의를 바탕으로 컨테이너 작업을 실행한다.
- EC2 인스턴스 또는 Fargate에서 지정된 Docker 이미지를 다운로드하고 컨테이너를 시작한다.
