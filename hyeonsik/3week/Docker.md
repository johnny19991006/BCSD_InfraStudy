# 도커란?
> Linux 컨테이너를 기반으로 하여 특정한 서비스를 패키징하고 배포하는 데 유용한 오픈소스 프로젝트이다.

- 컨테이너 기술을 기반으로 한 일종의 가상화 플랫폼
- 독립된 환경을 만들어서 하드웨어를 효율적으로 활용할 수 있는 기술

# 도커는 왜 쓰는가?
- 보통 로컬에서 정상적으로 동작하던 어플리케이션이 서버에서는 환경변수의 충돌과 같은 문제로 동작을 하지 않는 경우가 있는데, 이를 해결하기 위해 나온 것이 도커이다.
- 도커는 이러한 환경을 감싸는 동일한 컨테이너를 서버와 로컬에서 사용함으로써, 동일한 환경에서 어플리케이션을 동작하게 해준다.
- 그리고 각 컨테이너는 독립적이기 때문에, 유지/보수가 용이하다.
  - 트래픽이 큰 폭으로 달라질 경우, 서버를 축소/확대하거나 새로 구축하는 것보다 도커의 컨테이너를 추가/삭제하는 것이 더 적은 비용이 든다.
  - 또한 컨테이너 간에는 독립적이기 때문에 모듈과 같이 필요에 따라 여러 컨테이너들을 조합하여 원하는 환경을 구축할 수 있기 때문에 서버를 손대는 것 보다 편하다.

# 도커와 가상머신

## 1. 가상머신(Virtual Machine) vs 도커 컨테이너(Docker Container)
- 기존에도 가상화 기술은 존재했지만, 도커 컨테이너와는 방식이 많이 다르다.
<img src="https://velog.velcdn.com/images/choon0414/post/5ea32c9c-9c94-41dc-976c-8bc143ec412d/image.png">

### 1) 가상머신(VM)
<img src = "https://velog.velcdn.com/images/choon0414/post/669801a4-2ba8-4ece-9d53-5ea082dea438/image.png">

- 기존의 VM은 하이퍼바이저를 이용해 여러 개의 운영체제를 하나의 호스트에서 생성해 사용하는 방식이었다.
- 여러 개의 운영체제는 가상머신이라는 단위로 구분되고, 각 가상머신에는 우분투, CentOS 등의 운영체제가 설치되어 사용된다.
- 각 가상머신 별로 독립적으로 구성하기 위해 하이퍼바이저를 반드시 거쳐야 하는데, 이 때문에 성능 손실이 발생한다.
- 각 가상머신의 운영체제는 완전히 독립된 공간과 시스템 자원을 할당받아 사용한다.
- 하지만 이러한 운영체제를 사용하기 위해 필요한 라이브러리와 커널 등을 전부 가상머신에 포함하기 때문에 이미지로 만들었을 때 크기가 커진다.

### 2) 도커(Docker)
<img src = "https://velog.velcdn.com/images/choon0414/post/d37d98d5-fe2c-4b53-ae7d-a5de08c8b4c7/image.png">

- 도커는 가상화된 공간을 생성하기 위해 리눅스 자체 기능인 chroot, 네임스페이스, cgroup을 사용해 프로세스 단위의 격리 환경을 만들기 때문에 성능 손실이 거의 없다.
- 컨테이너에 필요한 커널을 공유해서 사용하고, 컨테이너 안에는 어플리케이션을 구동하는 데 필요한 라이브러리 및 실행 파일만 존재하기 때문에 컨테이너를 이미지로 만들었을 때 이미지 용량 또한 VM에 비해 많이 적다.

## 2. 도커의 구성요소
<img src = "https://velog.velcdn.com/images/choon0414/post/e2a475eb-7138-4958-ab49-1271f2dae6df/image.png">

- Docker Client : 설치된 도커 파일, build, pull, run 등의 도커 명령어를 수행한다.
- Docker Host : 도커가 띄워져 있는 서버, 컨테이너와 이미지를 관리한다.
- Docker daemon : 도커 엔진
- Refistry : 외부 이미지 저장소, 다른 사람들이 공유한 이미지를 로컬의 도커 호스트에 pull할 수 있다.

## 3. 이미지와 컨테이너
<img src = "https://velog.velcdn.com/images/choon0414/post/6e5f6994-e166-4c5e-bd52-574650d89f3e/image.png">

도커 이미지와 컨테이너의 관계는 프로그램과 프로세스, 클래스와 인스턴스의 관계, 즉 틀과 결과물의 관계와 비슷하다고 생각하면 편하다.

### 1) 도커 이미지
>   이미지는 Docker container를 생성하기 위한 read-only 템플릿

- 이미지는 Registry에서 다운로드 받아 와 사용할 수 있고, 기존 이미지를 커스터마이징해 새로운 이미지를 생성할 수도 있다.

### 2) 도커 컨테이너
> 실행 가능한 이미지의 인스턴스 즉, 컨테이너는 이미지를 읽어와 실행 중인 하나의 어플리케이션 프로세스

- 도커 이미지로 생성할 수 있으며, 컨테이너를 생성하면 해당 이미지의 목적에 맞는 파일이 들어있으며 호스트나 다른 컨테이너로부터 독립(분리)된 시스템 자원 및 네트워크를 사용할 수 있는 공간이 생성된다.
- 같은 이미지로 생성된 두 개의 컨테이너는 완전히 독립된 다른 개체이다.
- 컨테이너 내에서 실행되거나 변경되는 데이터들은 별도로 관리하지 않으면 컨테이너 삭제 시 함께 삭제된다.
### 3) 도커 컨테이너 구성요소
  - 구성 (Configuration) : 컴퓨터 시스템, 서버 및 소프트웨어를 원하는 상태로 일관되게 유지하기 위한 파일 또는 설정
  - 소스 코드 (Source code) : 어플리케이션의 소스 코드 등
  - 플랫폼 (Platform) : 소프트웨어 개발 플랫폼 (nodejs, php, python ...)
  - 패키지 관리자 (Pacakage manager) : 프로그램 또는 라이브러리 등의 설치, 업그레이드, 구성 제거 과정을 자동화하는 소프트웨어 도구 모음 (npm, pip ...)
  - 의존성 (Dependencies) : 실행하고자 하는 어플리케이션에 필요한 라이브러리 버전 등
  - 기타 소스 자료 : 어플리케이션 실행에 필요한 자료 (데이터, 이미지 파일 등)

<br>

---

__[참고자료]__

[도커에 대한 어떤 것 : 1. 도커란 무엇인가?](https://seosh817.tistory.com/345#Virtual%20Machine(%EA%B0%80%EC%83%81%EB%A8%B8%EC%8B%A0)%20vs%20Docker%20Container(%EB%8F%84%EC%BB%A4%20%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88)-1)

[[Docker]도커란? - 도커 개념 정리](https://chonchony.tistory.com/entry/Docker-%EB%8F%84%EC%BB%A4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)

[도커란 무엇인가?](https://velog.io/@markany/%EB%8F%84%EC%BB%A4%EC%97%90-%EB%8C%80%ED%95%9C-%EC%96%B4%EB%96%A4-%EA%B2%83-1.-%EB%8F%84%EC%BB%A4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)

[Docker가 왜 좋은가?(Youtube)](https://www.youtube.com/watch?v=chnCcGCTyBg)

---

# 도커 네트워크
![](https://velog.velcdn.com/images/choon0414/post/01cbaebb-98f0-45b9-aa73-693f3915e61e/image.png)

## 도커 네트워크의 구조
- 도커는 컨테이너에 내부 IP를 순차적으로 할당하는데, 이 IP는 컨테이너를 재시작할 때마다 변경될 수 있다.
- 해당 내부 IP는 내부망에서만 사용할 수 있기 때문에 외부와의 연결이 별도로 필요하다.
- 도커는 각 컨테이너에 외부와의 네트워크를 제공하기 위해 컨테이너마다 가상 네트워크 인터페이스를 호스트에 생성하는데 이름이 veth로 시작한다.
  - veth는 컨테이너가 생설될 때 도커 엔진이 자동으로 생성한다.
- dockerO : 각 veth 인터페이스와 바인딩 되어 호스트의 ethO 인터페이스와 이어주는 브리지 역할을 한다.
- ethO : 공인 IP 또는 내부 IP가 할당되어 실제로 외부와 통신할 수 있는 호스트의 네트워크 인터페이스이다.
- 전체적인 흐름은 컨테이너의 ethO 인터페이스는 Host의 veth 인터페이스와 연결된 뒤, veth 인터페이스는 dockerO 브리지와 바인딩 되어 외부와 통신이 가능해지게 된다.

## 도커 네트워크 기능
도커 컨테이너를 생성하면 기본적으로 dockerO 브리지를 통해 외부와 통신할 수 있는 환경이 생성되는데, 사용자의 선택에 따라 원하는 네트워크 드라이브를 사용할 수도 있다. 종류는 다음과 같다.

### 1. 브리지 네트워크
- 사용자 정의 브리지를 새로 생성해 각 컨테이너에 연결하는 네트워크 구조이다.
- 컨테이너는 연결된 브리지를 통해 외부와 통신할 수 있다.

### 2. 호스트 네트워크
- 네트워크를 호스트로 설정하면 호스트의 네트워크 환경을 그대로 사용할 수 있다.
- 호스트 드라이버의 네트워크는 별도로 생성할 필요 없이 기존의 Host 네트워크를 사용하면 된다.

### 3. 논 네트워크
- 말 그대로 아무런 네트워크를 쓰지 않는 것이다.
- 외부와의 연결이 단절된 컨테이너로 로컬호스트 외에는 존재하지 않는다.

### 4. 컨테이너 네트워크
- 다른 컨테이너의 네트워크 네임 스페이스 환경을 공유할 수 있다.
- 내부 IP, 네트워크 인터페이스의 맥(MAC) 주소 등의 속성이 공유된다.
- 공유되는 두 컨테이너는 동일한 정보의 ethO를 가진다.
<br>

---

__[참고자료]__

[도커 네트워크 활용하기](https://devbksheen.tistory.com/entry/%EB%8F%84%EC%BB%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%ACdocker-network-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0)

[도커 네트워크](https://m.blog.naver.com/fbfbf1/223295798174)
