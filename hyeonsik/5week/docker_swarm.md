# 도커 스웜
- 도커가 공식적으로 만든 오케스트레이션 툴로, 쿠버네티스와 같이 컨테이너화 어플리케이션을 배포, 확장, 관리하기 위한 도구이다.

>__오케스트레이션 툴__이란?
>  - 여러 호스트 서버의 컨테이너들을 배포 및 관리하기 위한 툴
>  - 컨테이너 배포 뿐 아니라 다양한 기능을 가지고 있음
   - 컨테이너 자동 배치 및 복제
   - 컨테이너 그룹에 대한 로드밸런싱
   - 컨테이너 장애 복구
   - 클러스터 외부에 서비스 노출
   - 컨테이너 추가 또는 제거를 이용한 확장 및 축소
   - 컨테이너 서비스간에 인터페이스를 통한 연결 및 네트워크 포트 노출 제어
   
<br>

## 도커 스웜이 필요한 이유
- __도커__는 단일 호스트 안에서 컨테이너 기반 어플리케이션을 관리할 때 유용하다.
  - 하지만 단일 호스트로 구성된 환경은 확장성, 가용성, 장애허용성 측면에서 많은 한계점을 지니기 때문에 대부분의 서비스는 여러 대의 호스트를 운영한다.
- 여러 대의 호스트의 컨테이너를 관리하려면 도커만으로는 다음과 같은 한계가 있음
  - 서로 다른 호스트들을 어떻게 연결하고 관리할 것인?
  - 어떤 컨테이너를 어떤 호스트에 배치하여 구동시킬 것인가?
  - 각기 다른 호스트에 배치된 컨테이너들의 상호 통신을 어떻게 제어할 것인가?
- 이를 해결하기 위해 나온 것이 도커 스웜.
<br>

## 도커 스웜의 장점
- 여러 개의 Docker 호스트를 함께 클러스터링해 단일 가상 Docker 호스트를 생성함
- 스웜은 따로 설치나 설정 없이 바로 사용할 수 있는 Out-of-the-box 서비스이다.
- Docker 명령어와 Compose를 그대로 사용 가능함
<br>

## 도커 스웜 vs 쿠버네티스
### 1) 쿠버네티스(Kubernetes)
- 쿠버네티스는 다수의 컨테이너를 자동으로 배치 및 조정을 하며 어플리케이션의 전체적인 라이프 사이클을 관리한다.
- 자동 스케일링 및 여러 기능을 제공하여 많은 대기업에서 쿠버네티스 기반의 시스템을 사용한다.
- 기능
  - __자동화 및 스케일링__: 클러스터의 리스소를 동적으로 확장하고 축소하는 기능을 제공해 어플리케이션의 스케일링을 자동화 함
  - __다양한 컨테이너 오케스트레이션__: 로드 밸런싱, 롤링 업데이터, 롤백, 자동 복구 등과 같은 다양한 오케스트레이션 기능을 제공하여 어플리케이션 배포 및 관리를 편리하게 함
  - __유연한 아키텍쳐__: 쿠버네티스의 모듈화된 아키텍처는 다양한 환경에서도 일관된 방식으로 동작함
  - __세밀한 컨트롤 및 구성, 선언적 구성, 로드 밸런싱__ 등
  
### 2) 도커 스웜(Docker Swarm)
- 개인 프로젝트나 소규모 어플리케이션에서 사용하기 좋음
- 기능
  - __쉬운 설정 및 사용__: 도커 스웜은 도커 엔진과 함께 제공되어 별도의 설치를 필요로 하지 않으며, 쿠버네티스보다 간단하게 구성 및 설정을 할 수 있음
  - __도커와의 통합__: 도커와 도커 컴포즈의 명령어를 그대로 사용 가능함
  - __단일 벤더 종속성__: 도커 스웜은 도커의 일부로 사용되며, 단일 벤더 종속성이 적기 때문에 간단한 구조에 유리할 수 있음
<br>

## 주요 용어
- `Compose` : 주로 단일 호스트에서 여러 컨테이너로 구성된 도커 어플리케이션 관리
- `Swarm` : 주로 여러 호스트에서 클러스터 구축 및 관리
- `Service` : Swarm에서 클러스터 안의 서비스(컨테이너 하나 이상의 집합)를 관리
- `Stack` : Swarm에서 여러 개의 서비스를 합한 전체 어플리케이션을 관리
- `노드` : 클러스터를 구성하는 개별 도커 서버
  <img src = https://velog.velcdn.com/images/choon0414/post/f9a65395-c057-4aa9-b783-955c0d6f0cd2/image.png width = "70%">
  - `매니저 노드` : 클러스터 관리와 컨테이너 오케스트레이션을 담당하는 노드
    - 쿠버네티스 `마스터 노드`와의 차이점은, 도커 스웜의 `매니저 노드`는 기본적으로 `워커 노드`의 역할도 같이 수행할 수 있다는 점이다.
  - `워커 노드` : 컨테이너 기반 `Service`들이 실제 구동되는 노드
<br>

## 도커 스웜 활성화
- 도커 스웜 확인
  ```
  docker info | grep Swarm
  ```
  <img src = https://velog.velcdn.com/images/choon0414/post/272d1cdd-3b72-41df-9e3d-55c8dca4d8bd/image.png>
  
  - 별도의 설치 없이도 도커 엔진 자체에 내장되어 있어서 이를 확인할 수 있다. 이제 이걸 설정을 통해 활성화 시키면 사용이 가능하다.
- 매니저 노드로 사용할 서버에서 스웜 클러스터 시작
  - 매니저 노드: 어플리케이션 서버(3.35.0.158)
  - 워커 노드: DB 서버(3.36.123.32)
  ```
  docker swarm init --advertise-addr 3.35.0.158
  ```
  <img src = https://velog.velcdn.com/images/choon0414/post/cb8b65a2-5ce9-4a78-9563-62c504f4e8bf/image.png>
  
  - 다른 서버에서 해당 클러스터에 새로운 워커 노드를 추가할 때 --token의 비밀키를 입력하면 된다.
- 매니저 노드가 있는 서버의 인바운드 규칙에 2377 포트번호를 추가한다.
  <img src = https://velog.velcdn.com/images/choon0414/post/b976540e-1106-4685-ae73-767fc16d3f1e/image.png>

- 워커 노드로 사용할 서버에서 클러스터에 추가
  ```
  docker swarm join --token [비밀키] [매니저노드 IP]:2377
  ```
  <img src = https://velog.velcdn.com/images/choon0414/post/065fb296-d962-47af-832a-3f0cdcb00e87/image.png>

- 매니저 노드가 있는 서버에서 워커 노드 추가가 잘 되었는지 확인할 수 있다.
  ```
  docker node ls
  ```
  <img src = https://velog.velcdn.com/images/choon0414/post/d18b121f-b7bc-4c9d-8d01-0f32039b4b30/image.png>


--- 

#### [참고자료]
[Docker Swarm이란](https://honggg0801.tistory.com/22)
[Docker Swarm의 주요 용어, 활성화 방법 및 노드(Node) 관리법 살펴보기](https://seongjin.me/docker-swarm-introduction-nodes/)
[[Kubernetes]: 왜 쿠버네티스인가? Docker Swarm과의 차이는?](https://varconst.com/kubernetes_vs_docker_swarm/)
[{개발자}로 자라기 – 쿠버네티스, 왜 배워야 할까?](https://blog.goorm.io/kdt_kubernetes/)
[[Docker] Docker Swarm Cluster 생성](https://jojaeng2.tistory.com/46)
[도커 스웜 배포](https://battlecook.github.io/2021/05/30/deploy-in-docker-swarm.html)
