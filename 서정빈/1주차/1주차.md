# 도커 & 인프라 1주차 정리

# AWS

아마존에서 운영중인 클라우드 컴퓨팅 시스템(Amazon Web Services)
세계적으로 가장 많이 사용하는 클라우드 컴퓨팅 시스템으로 업계 1위를 달리고 있음
대표적인 인프라 기술로는 컴퓨팅(EC2), 스토리지(S3), 데이터베이스를 제공
현재 동아리에서는 EC2, S3, CloudFront, Route 53 등을 사용하고 있음

# 클라우드 컴퓨팅

인터넷(일명 “클라우드”)을 통하여 서버와 스토리지, DB, SW, 분석 등 컴퓨팅 서비스를 제공하는 것
사용자는 클라우드 제공자가 제공하는 서비스를 통해 필요할 때마다 사용하고, 사용한 만큼만 비용을 지불

### 특징

- **주문형 자원 :** 필요시 자원을 즉시 할당 가능
- **광대역 네트워크 접근 :** 인터넷을 통해 바로 접근 가능
- **자원 풀링 :** 여러 사용자가 자원을 공유하지만, 사용자는 독립적으로 자원 사용 가능
- **탄력성과 측정 서비스 제공 :** 자원 확성정 용이 및 자원의 사용량 측정 및 관리 가능

### 장점

- **비용 절감 :** 초기 인프라 투자 비용 미필요, 사용한 만큼만 비용 지불
- **유연성과 확장성 :** 자원을 쉽게 확장/축소 가능
- **빠른 배포 :** 새로운 서비스 빠르게 개발 및 배포
- **가용성 및 복원력 :** 데이터 센터 물리척 위치 및 무관하게 높은 가용성/복원력 제공
- **업무 효율성 향상 및 전문 기술 활용 :** 관리형 서비스로 인프라 관리 감소 및 최신 인프라 활용 가능

### 단점

- **보안 및 프라이버시 문제 :** 인터넷을 이용하기 때문에 프라이버시 이슈 발생 가능
- **인터넷 의존성 :** 인터넷 연결 의존으로 인한 네트워크 장애 시 서비스 영향 받음
- 비용 과다 청구 : 예상치 못한 비용 발생 가능

### 서비스 모델

- **IaaS(Infrastructure as a Service) :** 서버, 스토리지, 네트워크 등 인프라 가상화 제공(AWS EC2, Google Compute Engine)
- **PaaS(Platform as a Service) :** 애플리케이션 개발 및 배포 환경을 제공(Google App Engine, AWS Elastic Beanstalk)
- **SaaS(Software as a Service) :** 소프트웨어 애플리케이션을 인터넷을 제공(Google Workspace, Microsoft Office 365)

# 온프레미스

온프레미스(On-Premises)란 기업 자체가 데이터 센터나 서버를 통해 IT 인프라를 직접 구축하고 운영하는 방식

### 특징

- **내부 리소스 :** 모든 HW와 SW를 기업 내부에서 관리
- **제어권 통제 :** 인프라 및 데이터에 대한 완전한 통제권을 가짐
- **맞춤형 인프라 :** 기업의 특정 요구에 맞춰 인프라 설계 및 최적화 가능

### 장점

- **보안 및 데이터 제어 :** 데이터와 인프라 직접 제어로 보안과 프라이버시 통제 가능
- **독립성 :** 클라우드 제공업체에 종속되지 않으며 자유로운 HW/SW 사용 가능

### 단점

- **비싼 초기 비용 :** HW, SW, 설치 및 유지보수 초기 투자 비용이 큼
- **유연성 부족 :** 리소스 확장 및 축소에 시간 걸림, 수요 변화에 느림
- **관리 부담 :** 인프라 유지보수 및 업데이트, 보안 패치 내부 관리의 필요

# VPC

퍼블릭 클라우드 환경에서 사용할 수 있는 고객 전용 사설 네트워크 시스템(Virtual Private Cloud)

### 특징

- **전용 네트워크 사용 :** 다른 네트워크 간 상호 간섭이 염려 없이 논리적으로 완전 분리된 네트워크 사용 가능
- **다양한 네트워크 토폴로지 :** VPC 내부에 Public Subnet / Private Subnet을 생성해 고객 맞춤형 네트워크 환경 조성 가능
- **강력한 보안 :** ACG(Access Control Group) / Network ACL(Access Control List)을 통하여 서버 단계 접근을 제어 / Subnet 단계의 접근 제어

- Subnet이란? : 서브 네트워크 → 즉 네트워크 속의 네트워크. 효율적인 네트워크 구성 가능

### 주요 구성 요소

- **Subnet :** VPC 내에서 IP 주소 범위를 분할/사용하는 서브 네트워크, public과 private으로 나누기 가능
- **Route Table :** VPC 내에서 트래픽 경로를 지정하는 테이블 / 트래픽 흐름 제어(데통 때 배웠다)
- **인터넷 게이트웨이 :** VPC - 인터넷 통신을 가능하게 해줌, public Subnet 배치 인스턴스 통신 담당
- **NAT 게이트웨이 :** private Subnet의 인스턴스가 인터넷에 접근할 수 있도록 하는 게이트웨이
  이 게이트웨이를 이용해서 외부로의 통신이 가능

빌드 서버의 VPC ID를 가져와봤다

<img width="248" alt="VPC" src="https://github.com/johnny19991006/BCSD_InfraStudy/assets/149302959/2ad189e5-54be-417b-a334-59d7af4b551f">

# CIDR

CIDR(Classless Inter-Domain Routing)은 인터넷 상 데이터 라우팅 효율성 향상을 위한 IP 주소 할당 방법
이를 사용하면 이점

### 특징

- **IP 주소 낭비 감소 :** IP 주소에 할당할 네트워크 및 호스트 식별자 결정 시 유연성 제공, CIDR을 사용하면 특정 네트워크에 필요한 IP 주소를 프로비저닝하여 낭비 감소 → 라우팅 테이블 항목 감소, 데이터 패킷 라우팅 단순화
- **데이터 전송 고속화 :** 라우터에서 보다 효율적인 IP주소를 여러 Subnet으로 구성 가능, 모든 디바이스는 동일한 서브넷에 있으며 동일한 IP 주소 접두사 사용. 이 때 Subnet을 이용하면 불필요한 라우터(경로)를 사용하지 않고 데이터가 대상 주소에 도달 할 수 있음
- **VPC 생성 :** 연결된 디바이스 간 데이터 패킷 전송시 CIDR IP를 사용

### 작동 방법

- CIDR을 이용시 라우터에서 표현된 Subnet에 따라 해당하는 디바이스로 데이터 패킷 라우팅 가능
- 라우터는 클래스가 아닌, CIDR 접미사의 지정된 네트워크 및 호스트 주소를 검색
- CIDR 블럭은 동일 네트워크 접두사와 비트 수를 공유하는 IP 주소 모음
  ex ) 192.168.1.0을 22비트 네트워크 식별자를 사용해 192.168.1.0/22로 표현 가능
<img width="437" alt="CIDR" src="https://github.com/johnny19991006/BCSD_InfraStudy/assets/149302959/d3b94a1d-511b-48a7-bca5-a50347a3ab8f">


# EC2

AWS EC2(Elastic Compute Cloud)는 AWS에서 제공하는 클라우드 컴퓨팅 서비스
클라우드에서 가상 서버 생성 및 관리 할 수 있도록 함 → 가상의 컴퓨터 한 대를 빌리는 것

### 특징

- **효율성 :** 쉽게 서버를 생성할 수 있기 때문에 실제 서버 구축보다 간단
- **가격 절감 :** 사용한 만큼만 요금을 지불하면 되므로 비용 절감

인스턴스를 생성한다는 것은 AMI를 토대로 가상의 컴퓨터를 빌리는 것임

*AMI : EC2 인스턴스를 시작하는 데 필요한 정보가 들어있는 이미지 → EC2의 복사본

### 인스턴스 유형

- **범용 :** vCPU, 메모리, 네트워크, 저장 공간등 평균사양으로 제공
- **컴퓨팅 최적화 :** 메모리 대비 vCPU 비율이 높음
- **메모리 최적화 :** 메모리 용량이 높음
- **스토리지 최적화 :** 스토리지 용량이 훨씬 크거나 초고속 입출력 제공
- **GPU 인스턴스 :** 고성능 엔비디아 GPU / CUDA(GPGPU 플랫폼) 실행할 때 사용
- **마이크로 인스턴스 :** 가장 저렴함. 작은 vCPU, 적은 메모리
* vCPU란? : 가상화 SW를 통해 제공되는 CPU를 vCPU라 함(Virtual CPU)

### 인스턴스 상태

- **pending :** EC2 가동을 위해 준비하는 과정
- **running :** 실제로 EC2를 사용할 수 있는 상태, 중지 / 재부팅 / 최대 절전모드 보유
- **중지 :** 인스턴스를 잠시 멈추는 것, 인스턴스 요금 미청구, 퍼블릭 IP 변경
- **재부팅 :** 인스턴스 재시작, 중지 → 재시작과 달리 퍼블릭 IP의 변동 X
- **최대 절전모드 :** 메모리 내용 보존하여 재시작시 중단지점 시작할 수 있는 모드
- **shutting-down :** 인스턴스 종료중, EBS 남기고 인스턴스만 종료 가능
* **EBS(Elastic Block Store)란? :** 데이터 저장 역할, 가상 저장 장치를 말함(프리티어 무료사용 가능)
  볼륨 / 이미지 / 스냅샷 / IOPS라는 개념을 가짐
- **terminated :** 완전히 종료 및 인스턴스의 영구 삭제

→ KOIN에서는 빌드, 스테이지, 프로덕션, DB를 EC2를 통해 구동하고 있음
저번에 AWS 서버열기 진행하고 한 달 안 닫아서 14000원 나간 거 생각하면 마음이 아픔

# S3

SSS의 약자(Simple Storage Service)
AWS가 제공하는 클라우드 스토리지 서비스, 파일 및 데이터 등 다양한 유형의 미디어 저장 및 관리
데이터 양에 대한 비용도 저렴 및 저장하는 데이터 양도 무한에 가까움

### 버킷의 특징(장바구니)

- 버킷의 이름은 유일(전 세계에서 유일한 ID만 사용가능)
- 지역을 선택해야 함
- 버전관리를 통한 사용자 실수도 복원이 가능(Git의 기능)

### 객체의 특징(물건)

- 하나의 크기는 1바이트부터 5테라까지
- 저장 가능한 객체 갯수는 무제한
- 객체마다 각각의 접근 권한 설정이 가능

### S3 사용 이유

- **스토리지 및 데이터 저장 :** 데이터 저장 공간 제공 및 어느 곳에서든 접근 가능
- **확장성 :** 확장 가능한 서비스로 파일 추가 및 삭제, 조정 가능
- **데이터 보안 및 접근 제어 :** 데이터 암호화 저장 및 접근 권한 제어로 접근/수정 관리 가능
- **데이터 백업 및 복원 :** 필요 경우 데이터를 원래 상태로 복원 가능
- **웹 호스팅 및 정적 웹 사이트 호스팅 :** 비용 절감 및 빠르고 안정적인 웹 호스팅 환경 구축 가능
- **데이터 전송 및 배포 :** 글로벌한 데이터 업로드 및 다운로드 가능
- **비용 효율성 :** 사용한 용량에 따른 과금, 필요한 비용 지불로 유연한 사용 가능

들어가서 봤는데, 3개의 S3 중 최근 사용은 하나만 있는 듯 싶음

# CDN

CDN(Content Delivery Network)는 데이터 사용량이 많은 앱의 웹 페이지 로드 속도 증가를 위해 사용되는 상호 연결된 서브 네트워크
목표는 대기 시간을 줄이거나 네트워크 설계로 인해 발생하는 통신 지연을 줄이는 것
→ 이는 클라이언트와 웹 사이트 서버 간 중간에 서버를 두어 효율성을 높임

### 장점

- **페이지 로드 시간 단축 :** 반송률을 줄이고 사용자가 사이트에 머무는 시간을 증가
- **대역폭 비용 감소 :** 오리진 서버의 제공 데이터의 양을 줄여 호스팅 비용 절감
- **콘텐츠 가용성 제고 :** 웹 트래픽 처리 및 로드를 줄임, 하나의 CDN 서버가 오프라인 전환 시 다른 운영 서버의 대체로 서비스 중단을 방지함
- **웹 사이트 보안 강화 :** 로드 분산으로 오리진 서버에 미치는 영향을 줄임으로 트래픽 급증 처리 가능

이는 정적 콘텐츠와 동적 콘텐츠를 전달 할 수 있음

→ Amazon CloudFront가 CDN의 주 사용 예시임, 프로덕션에 적용되는 듯 싶음

# Route 53

가용성과 확장성이 뛰어난 DNS 웹 서비스

도메인 구입부터 네임서버 등록까지 dns에 필요한 모든 기능 보유, 모니터링 기능 보유

### 특징

- 가용성과 확장성이 뛰어난 클라우드 기반 DNS 웹 서비스
- 동적으로 사용자에게 노출될 DNS 레코드 타입 및 값 조정 가능
- 각종 다양한 로드밸런싱 기능 지원 
- 로드밸런싱이란? : 부하분산으로, 네트워크 트래픽을 균등 배포하는 것
- 사용자의 요청을 앞에서 말한 EC2, S3 버킷 등 인프라 직접 연결 가능
- 외부의 인프라로 라우팅하는데 사용 가능
- Route 53 트래픽 흐름을 사용하면 지연시간기반 라우팅 가능
- Route 53에서는 도메인 이름 등록도 지원 가능

현재 동아리 내에서 사용하고 있는 Route 53으로는 쩝박, KOIN, bcsdlab로 3개의 사이트를 호스팅 중

# NACL

NACL(Network Access Control List)는 1개 이상의 Subnet 내/외부의 트래픽을 제어하기 위한 방화벽 역할을 하는 VPC(Virtual Private Cloud)를 위한 선택적 보안 계층

# NACL 특징

- 보안 그룹처럼 방화벽 역할을 담당
- Subnet 단위, 인스턴스 단위 제어 불가능 및 다양한 Subnet 1:N 연동 가능
- Port 및 IP를 직접 거부 가능(외부 공격 상황 등 특정 IP 블록 할 때 사용)
- Stateless - 들어오는 트래픽, 나가는 트래픽 구분 X(Outbound에 임시 포트 범위 열어야 정상 통신 가능)


### NACL 규칙(아래 예시 첨부)

- **규칙 번호 :** 규칙에 부여되는 고유 숫자이며 규칙의 평가 순서(오름차순)
- **유형 :** 트래픽 유형(ssh = 22, DNS = 53, UDP = 17)
- **프로토콜 :** 통신 프로토콜(TCP, UDP, SMP)
- **포트 범위 :** 허용 혹은 거부할 포트 범위
- **소스 :** 주소의 CIDR 블록
- **허용/거부 :** 허용 혹은 거부 여부
<img width="684" alt="NACL" src="https://github.com/johnny19991006/BCSD_InfraStudy/assets/149302959/31771a80-ab58-4b5b-bb00-5749e6920167">


  여기서는 들어오는 112.12.35.4/32를 규칙번호 200번으로 정의하면, 규칙 번호 100번에서는 모든 IP를 허용하였으므로 해당 IP는 정상 접속이 가능. 이를 거부하고 싶으면 규칙 번호 100번에서 정의해야 함


### 고려할 점

- Outbound를 잘 고려해야함(Stateless기 때문에) - 서브넷 입장/퇴장 트래픽에만 적용
- Subnet 내부의 트래픽에는 적용 X
- 모든 트래픽은 Allow지만, 직접 생성하는 경우 NACL의 경우 모든 트래픽 Deny
- 하나의 Subnet은 하나의 NACL만 연동 가능, 하나의 NACL은 여러 Subnet에 연동 가능

# Security Group

Security Group은 연결된 리소스 도달 및 퇴장에 대한 트래픽을 제어
예를 들어 KOIN에서는 EC2 인스턴스와 연결, 이에 대한 인/아웃바운드 트래픽을 제어함(가상 방화벽)
여기서 인바운드는 외부 → 인스턴스, 아웃바운드는 인스턴스 → 외부를 말함
이는 위에서 말한 VPC내에서 ENI(Elsatic Network Interface)를 갖는 모든 서비스에 탑재 가능
<img width="905" alt="Inbound" src="https://github.com/johnny19991006/BCSD_InfraStudy/assets/149302959/e5c5087d-1676-4d56-bdd1-c3807e05a2a5">

Stage에 있는 인바운드의 보안 규칙
여기서는 프로토콜의 유형과, 포트 그리고 IP(대상)을 정할 수 있음
<img width="906" alt="Outbound" src="https://github.com/johnny19991006/BCSD_InfraStudy/assets/149302959/efb23c5f-b5a8-4c76-a62a-e664d483b8e2">

여기서는 아웃바운드의 보안 규칙
아웃바운드는 EC2에서 출발하는 모든 트래픽을 모두 허용
위의 인바운드 규칙에서 볼 수 있듯 특정 포트만을 허용하여 프로토콜을 선택해서 받을 수 있음

### 특징

- Security Group은 인바운드, 아웃바운드 규칙으로 나뉨
- 허용 규칙만 생성 → Deny는 위에서 말했던 NACL에서 할 수 있음
  특정 차단은 안되고, 일부를 허용하여 간접 차단은 가능
- 기본적으로는 보안 그룹의 아웃바운드 규칙은 모든 아웃바운드 트래픽 허용(위 사진처럼)
- Security Group은 인스턴스 단위 설정이 가능하고, 하나에 하나 이상의 Security Group을 설정(5개까지)
  Stage에는 Web, SSH, MySQL, DockerSwarm 4개의 Security Group이 설정되어 있음
<img width="286" alt="BCSDbound" src="https://github.com/johnny19991006/BCSD_InfraStudy/assets/149302959/2bb49358-ea45-469f-8562-0724a71c67de">


- 각 인스턴스에 서로 다른 Security Group 할당 가능, 연결되는 동안 Security Group의 모든 룰을 적용받음
- 상태를 저장하여 한 번 인/아웃바운드를 통과한 트래픽은 아웃/인바운드의 규칙 적용 X(Stateful)

## Stateful?

위의 마지막 특징이 Security Group의 가장 큰 특징

인바운드에 허용된 프로토콜은 아웃바운드 규칙에 영향을 받지 않고 왕래 가능
예를 들어, 인바운드에서 80번 포트를 허용하고 아웃바운드는 none
클라이언트가 80번 포트로 요청 → 인바운드 통과 → 인스턴스 응답은 아무것도 허용하지 않아도 Stateful하기에 왕래가 가능한 상태가 됨

# NACL vs Security Group

Security Group이 인스턴스의 접근 제어 목록이면, NACL은 Subnet을 오고가는 모든 트래픽을 제어
VPC에 Subnet이 포함, Subnet에는 인스턴스가 포함되는 관계
→ Subnet의 모든 트래픽은 NACL의 규칙을 적용 받음
아래는 포함 관계에 대한 그림

<img width="177" alt="Security" src="https://github.com/johnny19991006/BCSD_InfraStudy/assets/149302959/aea1dd6a-6b4d-4f81-94cf-ce2559dbed7a">


### 차이점

- Secutriy Group은 Stateful, NACL은 Stateless
- Security Group은 허용 규칙만, NACL은 거부 규칙까지 생성 가능
- Security Group은 모든 규칙을 동시에 평가, NACL은 번호 순서대로 평가(낮은 순서대로)


### 피드백 받은 내용 추가
- 네트워크 주소와 호스트 주소 나누는 법
- IP 주소는 32비트(IPv4)로 표현 -> 192.168.1.10
- 서브넷 마스크는 네트워크와 호스트 부분을 분리하는 데 사용 -> 255.255.255.0

이를 구분하는 방법으로는, 위에 주어진 IP 주소와 서브넷마스크로 각 주소를 구할 수 있음
- 각각 네트워크 주소는 AND 연산을 취함
- ex) 11000000.10101000.00000001.00001010 || 11111111.11111111.11111111.00000000
- 네트워크 주소는 11000000.10101000.00000001.00000000 -> 192.168.1.0

- 호스트 주소는 서브넷 마스크의 반전(NOT)과 IP의 AND로 계산
- ex) 11000000.10101000.00000001.00001010 || 00000000.00000000.00000000.11111111
- 호스트 주소는 00000000.00000000.00000000.00001010 -> 0.0.0.10

### EBS란?
- AWS에서 EC2 인스턴스에 사용할 영구 스토리지 볼륨(하드디스크 역할)
- 가용 영역 내에 자동 복제로 장애로부터 보호 및 고가용성, 내구성 제공
- 이는 SnapShot을 이용한다(Docker에서 Image 저장할 때 쓰는 것 처럼)
- 특정 시간의 EBS 저장본을 S3에 저장, 필요시 SnapShot으로 특정 시간 EBS 복구 가능

### 엣지 로케이션
- AWS CloudFront와 Route53의 캐시서버
- 각 거점마다 가깝고 적당한 곳에 엣지 로케이션(임시 데이터 저장 센터)를 설치하여 운영
- 콘텐츠의 다운을 빠르게 하기 위해, 멀리 떨어진 서버 다운로드보다 가까운 서버가 훨씬 빠르기 때문에 주요 도시 캐시 서버 구축한 것
